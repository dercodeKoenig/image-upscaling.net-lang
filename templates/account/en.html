<!DOCTYPE html>
<html lang="{{lang}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
</head>
<body>

{% include 'navbar.html' %}
<script>
    document.getElementById("nav-account").classList.add("active");
</script>

<div class="container">
    <h1 class="mt-1 mb-1">Account</h1>
    <div class="row">
        <div class="col">
            <strong>{{ link_response }}</strong>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <p><strong>Email:</strong> <span id="email_display">Loading...</span></p>
            <p><strong>Client ID:</strong> <span id="client_id_display">Loading...</span></p>
            <p><strong>Balance:</strong> <span id="balance_display">Loading...</span></p>
            <p><strong>Quota (Used / Free):</strong> <span id="free_quota_display">Loading...</span></p>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <p>
                This service is free for everyone, with a daily request limit in place to ensure fair access and
                balanced use of computing resources.
            </p>
            <p><strong>Need more quota?</strong><br>
                Support the service with a donation — you'll receive extra quota based on the amount received after
                fees.<br>
                (PayPal and Stripe take a small cut from each transaction).
            </p>


            <p><strong>How it works:</strong><br>
                Your free quota resets daily. Paid quota only kicks in when your free quota is used up.<br>
                Information on pricing, discounts and free quota can be found <a href="{{ url_for('about') }}">here</a>.
            </p>


            <p><strong>Supported payment methods:</strong><br>
                PayPal <em>(Note: Donations below €0.40 may be eaten up by PayPal processing fees)</em><br>
                Stripe (credit card)
            </p>


            <div class="row">
                <div class="col-md-4 col-sm-6 col-xs-12">
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                        <input type="hidden" name="cmd" value="_donations">
                        <input type="hidden" name="business" value="imageupscaling.net@gmail.com">
                        <input type="hidden" name="item_name"
                               value="Running AI models requires powerful computers. Your support helps cover costs to keep the project running!">
                        <input type="hidden" name="currency_code" value="EUR">
                        <input type="hidden" name="no_shipping" value="1">
                        <input type="hidden" name="custom" value="{{ client_id }}">
                        <input TYPE="hidden" NAME="return" value="{{ url_for('account.account', _external=True) }}">
                        <input TYPE="hidden" NAME="cancel_return"
                               value="{{ url_for('account.account', _external=True) }}">
                        <input TYPE="hidden" NAME="notify_url"
                               value="{{ url_for('ipn.paypal_ipn', _external=True, _scheme='https') }}">
                        <input style="width:200px;" type="image" name="submit"
                               src="{{ url_for('static', filename='assets/images/paypal-donate-button.png') }}"
                               alt="Donate">
                        <img alt="" width="1" height="1" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif">
                    </form>
                </div>
                <div class="col-md-4 col-sm-6 col-xs-12">
                    <form action="{{ url_for('account.stripe_pre_payment') }}" method="get" style="display: inline;">
                        <button type="submit" class="btn btn-dark">Donate via Stripe
                        </button>
                    </form>
                </div>
            </div>
            <br>
            <p>
                Donations are usually processed and linked to your account automatically within one minute — there's
                nothing more you need to do.<br>
                You’ll receive a confirmation email with a login link, which you can use if you’re ever logged out of
                your account.<br>
                If your email was previously linked to a different client ID, you’ll need to use the login link in the
                confirmation email or the form below to reconnect your email for security reasons.
            </p>
            <br>

        </div>
    </div>

    <div class="row">
        <div class="col">
            <strong>Connect your email</strong><br>
            <p id="email_connect_info_text"></p>
        </div>
    </div>

    <form action="{{ url_for('account.send_verification_mail') }}">
        <div class="row">
            <div class="col-9">
                <input name="email" required type="email" placeholder="enter your email" style="width:100%">
            </div>
            <div class="col-3">
                <input type="submit">
            </div>
        </div>
    </form>
</div>

</div>


<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

{% include 'footer.html' %}
{% include 'gtag.html' %}


<script>
    async function fetchAccountInfo() {
        try {
            const response = await fetch("{{ url_for('account.get_account_info') }}");
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();

            document.getElementById('client_id_display').innerHTML = data.client_id || 'N/A';

            document.getElementById('email_display').innerHTML = data.email || 'no email connected';

            const email_connect_info_text = document.getElementById('email_connect_info_text');
            if (data.email) {
                email_connect_info_text.innerHTML = 'An email is already connected to your account. You likely don’t need to use this form.';
            } else {
                email_connect_info_text.innerHTML = 'No email is currently connected to your account. ';
            }


            document.getElementById('balance_display').innerHTML = data.balance || 0;

            const maxFree = data.quota_free;
            const quotaUsed = data.quota_used;
            document.getElementById('free_quota_display').innerHTML = quotaUsed + ' / ' + maxFree;
        } catch (err) {
            console.error('Error fetching account info:', err);
        }
    }

    // Initial fetch
    fetchAccountInfo();
    // Periodic update every x seconds
    setInterval(fetchAccountInfo, parseInt("{{info_refresh_rate}}"));
</script>


</body>
</html>
